<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º–∏–Ω–∫–∞ - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏</title>
    <link rel="stylesheet" href="styles2.css">
</head>
<body>
    <h1>–ê–¥–º–∏–Ω–∫–∞ - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏</h1>

    <h2>–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</h2>
    <form id="addProductForm">
        <input type="text" id="name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" required>
        <input type="number" id="price" placeholder="–¶–µ–Ω–∞" required>
        <textarea id="description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" required></textarea>
        <input type="text" id="categories" placeholder="–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)" required>
        <button type="submit">–î–æ–±–∞–≤–∏—Ç—å</button>
    </form>

    <h2>–°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤</h2>
    <div id="products"></div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <h2>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä</h2>
            <input type="hidden" id="edit-id">
            <input type="text" id="edit-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" required>
            <input type="number" id="edit-price" placeholder="–¶–µ–Ω–∞" required>
            <textarea id="edit-description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" required></textarea>
            <input type="text" id="edit-categories" placeholder="–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)" required>
            <button onclick="saveEdit()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            <button onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:9050/products';

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤
        function loadProducts() {
            fetch(API_URL)
                .then(response => response.json())
                .then(products => {
                    let html = '';
                    products.forEach(product => {
                        html += `<div class="product-card">
                            <h3>${product.name}</h3>
                            <p><b>–¶–µ–Ω–∞:</b> ${product.price} —Ä—É–±.</p>
                            <p>${product.description}</p>
                            <p><b>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏:</b> ${product.categories.join(', ')}</p>
                            <button class="edit-btn" onclick="openEditModal(${product.id}, '${product.name}', ${product.price}, '${product.description}', '${product.categories.join(',')}')">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                            <button class="delete-btn" onclick="deleteProduct(${product.id})">–£–¥–∞–ª–∏—Ç—å</button>
                        </div>`;
                    });
                    document.getElementById('products').innerHTML = html;
                })
                .catch(error => console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤:', error));
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
        document.getElementById('addProductForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const newProduct = {
                name: document.getElementById('name').value,
                price: parseInt(document.getElementById('price').value),
                description: document.getElementById('description').value,
                categories: document.getElementById('categories').value.split(',').map(c => c.trim())
            };

            fetch(API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(newProduct)
            })
            .then(response => response.json())
            .then(() => {
                loadProducts();
                this.reset();
            })
            .catch(error => console.error('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞:', error));
        });

        // –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
        function deleteProduct(id) {
            if (confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç–æ–≤–∞—Ä?")) {
                fetch(`${API_URL}/${id}`, { method: 'DELETE' })
                    .then(() => loadProducts())
                    .catch(error => console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞:', error));
            }
        }

        // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        function openEditModal(id, name, price, description, categories) {
            document.getElementById('edit-id').value = id;
            document.getElementById('edit-name').value = name;
            document.getElementById('edit-price').value = price;
            document.getElementById('edit-description').value = description;
            document.getElementById('edit-categories').value = categories;
            document.getElementById('editModal').style.display = 'block';
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        function closeModal() {
            document.getElementById('editModal').style.display = 'none';
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ç–æ–≤–∞—Ä–∞
        function saveEdit() {
            const id = document.getElementById('edit-id').value;
            const updatedProduct = {
                name: document.getElementById('edit-name').value,
                price: parseInt(document.getElementById('edit-price').value),
                description: document.getElementById('edit-description').value,
                categories: document.getElementById('edit-categories').value.split(',').map(c => c.trim())
            };

            fetch(`${API_URL}/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(updatedProduct)
            })
            .then(() => {
                closeModal();
                loadProducts();
            })
            .catch(error => console.error('–û—à–∏–±–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞:', error));
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–≤–∞—Ä—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        loadProducts();
    </script>
    <div id="chat">
        <h2>üí¨ –ß–∞—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏</h2>
        <div id="messages"></div>
        <input type="text" id="messageInput" placeholder="–ù–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ...">
        <button onclick="sendMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </div>
    
    <script>
        const socket = new WebSocket('ws://localhost:9070');

socket.onmessage = (event) => {
    const msgDiv = document.createElement('div');
    msgDiv.textContent = event.data;
    document.getElementById('messages').appendChild(msgDiv);
};

function sendMessage() {
    const message = {
        user: "–ê–¥–º–∏–Ω",
        text: document.getElementById('messageInput').value
    };
    socket.send(JSON.stringify(message));
    document.getElementById('messageInput').value = '';
}
    
    </script>
</body>
</html>
